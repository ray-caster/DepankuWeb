{% extends "base.html" %}

{% block title %}Conversation - Depanku{% endblock %}

{% block head_extra %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/messages.css') }}">
{% endblock %}

{% block content %}
<main class="container messages-page">
    <div class="mb-3">
        <a href="{{ url_for('messaging.messages_page') }}" class="btn btn-outline">‚Üê Back to Inbox</a>
    </div>

    <div id="loading-container" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading conversation...</p>
    </div>

    <div id="chat-window" class="card" style="display: none;">
        <div class="card-header d-flex align-items-center p-3">
            <img src="/static/images/default-avatar.png" id="otherUserAvatar" alt="Avatar" class="conversation-avatar">
            <h5 id="otherUserName" class="mb-0"></h5>
        </div>

        <div id="messagesContainer" class="card-body message-container">
            <!-- Messages will be loaded here -->
        </div>

        <div class="card-footer message-input-container">
            <form id="messageForm" class="message-input-form">
                <input type="text" id="messageInput" class="form-control message-input"
                    placeholder="Type your message..." autocomplete="off" required>
                <button class="btn btn-primary" type="submit" id="sendBtn">Send</button>
            </form>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="{{ url_for('static', filename='js/messages.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const conversationId = '{{ conversation_id }}';
        if (window.messagingSystem) {
            window.messagingSystem.loadConversation(conversationId);
        }
    });
</script>
{% endblock %}